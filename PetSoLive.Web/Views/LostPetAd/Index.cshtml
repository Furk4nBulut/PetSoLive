@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Localization
@using PetSoLive.Web.Controllers
@inject IStringLocalizer<LostPetAdController> Localizer
@model IEnumerable<PetSoLive.Core.Entities.LostPetAd>

@{
    ViewData["Title"] = Localizer["Title"];
    Layout = "_Layout";
    var selectedCity = ViewData["SelectedCity"] as string;
    var selectedDistrict = ViewData["SelectedDistrict"] as string;
}

@section HeadSection {
    <link rel="stylesheet" href="~/css/lostPetAd.css?v=3.1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
}

<div class="lostpet-page">
    <a href="@Url.Action("Create", "LostPetAd")" class="btn btn-success btn-lg lostpet-add-btn" style="display: block; width: 100%; max-width: 1280px; margin: 0 auto 1.2rem auto; font-size: 1.35rem; padding: 1.2rem 0; border-radius: 16px; box-shadow: 0 4px 16px rgba(30,136,229,0.10); font-weight: 800; text-align: center; letter-spacing: 0.02em;">
        <i class="fas fa-plus-circle"></i> @Localizer["CreateNewAd"]
    </a>
    <div class="lostpet-main-flex">
        <!-- Filtre paneli tamamen kaldırıldı -->
        <div class="lostpet-content-area" style="width:100%;">
            <!-- Boydan boya arama çubuğu -->
            <div class="lostpet-searchbar-full">
                <div class="lostpet-searchbar-inner">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="İlanlarda isim veya açıklama ile ara..." />
                    <button class="clear-search-btn" id="clearSearch" title="@Localizer["ClearSearch"]"><i class="fas fa-times"></i></button>
                </div>
            </div>
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success">@TempData["SuccessMessage"]</div>
            }
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
            }
            <div class="lostpet-grid" id="lostpetGrid">
                @foreach (var ad in Model)
                {
                    <div class="lostpet-card" 
                         data-city="@ad.LastSeenCity" data-district="@ad.LastSeenDistrict" 
                         data-date="@ad.LastSeenDate.ToString("yyyy-MM-dd")" data-status="Lost" 
                         data-name="@ad.PetName" data-description="@(ad.Description ?? "")">
                        <div class="lostpet-card-img-wrap" style="position:relative;">
                            @if (!string.IsNullOrEmpty(ad.ImageUrl))
                            {
                                <img src="@ad.ImageUrl" alt="@Localizer["PetImage"]" class="lostpet-card-img" />
                            }
                            else
                            {
                                <div class="lostpet-card-placeholder"><i class="fa-solid fa-image fa-2x"></i></div>
                            }
                            <span class="city-badge">@ad.LastSeenCity</span>
                        </div>
                        <div class="lostpet-card-body">
                            <h5 class="lostpet-card-title"><i class="fa-solid fa-paw"></i> @ad.PetName</h5>
                            <div class="lostpet-card-meta">
                                <span class="lostpet-card-location"><i class="fa-solid fa-location-dot"></i> @ad.LastSeenLocation</span>
                                <span class="lostpet-card-date"><i class="fa-solid fa-calendar-days"></i> @ad.LastSeenDate.ToString("dd/MM/yyyy")</span>
                            </div>
                            <div class="lostpet-card-desc">@((ad.Description?.Length > 80) ? ad.Description.Substring(0, 80) + "..." : ad.Description)</div>
                            <a href="@Url.Action("Details", "LostPetAd", new { id = ad.Id })" class="btn-lostpet-action btn-lostpet-details"><i class="fa-solid fa-eye"></i> @Localizer["ViewDetails"]</a>
                        </div>
                    </div>
                }
            </div>
            @if (!Model.Any())
            {
                <div class="no-pets-message">
                    <p>@Localizer["NoLostPetsAvailable"]</p>
                </div>
            }
        </div>
    </div>
</div>
@section Scripts {
    <script src="~/js/lostPetAdFilter.js?v=3.1"></script>
    <script>
// Collapsable filtre bölümleri
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.filter-section-header').forEach(function(header) {
            header.addEventListener('click', function() {
                const targetId = header.getAttribute('data-target');
                const target = document.getElementById(targetId);
                const icon = header.querySelector('.collapse-icon');
                const expanded = header.getAttribute('aria-expanded') === 'true';
                if (expanded) {
                    target.style.display = 'none';
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-right');
                } else {
                    target.style.display = 'block';
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-chevron-down');
                }
                header.setAttribute('aria-expanded', !expanded);
            });
            header.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    header.click();
                }
            });
        });
    });
</script>
}
