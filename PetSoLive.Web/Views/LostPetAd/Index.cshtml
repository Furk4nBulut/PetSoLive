@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Localization
@using PetSoLive.Web.Controllers
@inject IStringLocalizer<LostPetAdController> Localizer
@model IEnumerable<PetSoLive.Core.Entities.LostPetAd>

@{
    ViewData["Title"] = Localizer["Title"];
    Layout = "_Layout";
    var selectedCity = ViewData["SelectedCity"] as string;
    var selectedDistrict = ViewData["SelectedDistrict"] as string;
}

@section HeadSection {
    <link rel="stylesheet" href="~/css/lostPetAd.css?v=3.1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
}

@section Scripts {
    <script src="~/js/lostPetAdFilter.js?v=3.1"></script>
}

<div class="lostpet-page">
    <div class="lostpet-toolbar" style="display: flex; align-items: center; justify-content: space-between; gap: 1.2rem; width: 100%; margin: 0 0 2rem 0; background: #f4f7fa; border-radius: 8px; box-shadow: 0 2px 16px rgba(30,136,229,0.10); padding: 1.5rem 2.5rem; border: 2.5px solid #e3e8ee; flex-wrap: wrap;">
        <!-- Şehir filtresi en solda -->
        <div style="flex:0 0 240px; min-width:160px;">
            <select id="cityFilterBar" class="form-select" style="width:100%; border-radius: 6px; border: 2px solid #cfd8dc; background: #fff; padding: 0.7rem 1.1rem; font-size: 1.08rem; font-weight: 500; transition: border 0.2s;" aria-label="Şehir seç"
                onfocus="this.style.borderColor='#42a5f5'" onblur="this.style.borderColor='#cfd8dc'">
                <option value="">@Localizer["AllCities"]</option>
                @foreach (var city in (ViewData["Cities"] as List<string> ?? new List<string>()))
                {
                    <option value="@city" selected="@(selectedCity == city ? "selected" : null)">@city</option>
                }
            </select>
        </div>
        <!-- Ortada ilan oluşturma butonu -->
        <div style="flex:1; display:flex; justify-content:center; min-width:180px;">
            <a href="@Url.Action("Create", "LostPetAd")" class="btn btn-success btn-lg lostpet-add-btn" style="font-size: 1.13rem; padding: 0.8rem 2.5rem; border-radius: 8px; background: linear-gradient(90deg, #1976d2 0%, #42a5f5 100%); border: none; color: #fff; font-weight: 800; box-shadow: 0 2px 8px rgba(30,136,229,0.10); letter-spacing: 0.02em; transition: background 0.2s, box-shadow 0.2s; display: flex; align-items: center; gap: 0.7rem; text-decoration: none; border: 2px solid #1976d2;"
               onmouseover="this.style.background='linear-gradient(90deg,#1565c0 0%,#42a5f5 100%)';this.style.boxShadow='0 4px 16px rgba(30,136,229,0.18)';" onmouseout="this.style.background='linear-gradient(90deg,#1976d2 0%,#42a5f5 100%)';this.style.boxShadow='0 2px 8px rgba(30,136,229,0.10)';">
                <i class="fas fa-plus-circle"></i> @Localizer["CreateNewAd"]
            </a>
        </div>
        <!-- En sağda arama çubuğu -->
        <div style="flex:0 0 340px; min-width:220px; position:relative;">
            <i class="fas fa-search search-icon" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:#42a5f5;"></i>
            <input type="text" id="searchInput" class="search-input" placeholder="@Localizer["SearchByNameOrDesc"]" style="padding-left:2.5rem; width:100%; border-radius: 6px; border: 2px solid #cfd8dc; background: #fff; font-size: 1.08rem; font-weight: 500; padding: 0.7rem 1.1rem 0.7rem 2.5rem; transition: border 0.2s;" onfocus="this.style.borderColor='#42a5f5'" onblur="this.style.borderColor='#cfd8dc'" />
            <button class="clear-search-btn" id="clearSearch" title="@Localizer["ClearSearch"]" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); background:transparent; border:none; color:#b0b8c1; font-size:1.1rem; cursor:pointer; padding:0;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <style>
            @@media (max-width: 1100px) {
                .lostpet-toolbar { flex-direction: column !important; align-items: stretch !important; gap: 1.1rem !important; padding: 1.2rem 0.7rem !important; }
                .lostpet-toolbar > div { min-width: 0 !important; flex: 1 1 100% !important; }
            }
        </style>
    </div>
    <div class="lostpet-main-flex">
        <div class="lostpet-content-area" style="width:100%;">
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success">@TempData["SuccessMessage"]</div>
            }
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
            }
            <div class="lostpet-grid" id="lostpetGrid">
                @foreach (var ad in Model)
                {
                    <div class="lostpet-card" 
                         data-city="@ad.LastSeenCity" data-district="@ad.LastSeenDistrict" 
                         data-date="@ad.LastSeenDate.ToString("yyyy-MM-dd")" data-status="Lost" 
                         data-name="@ad.PetName" data-description="@(ad.Description ?? "")">
                        <div class="lostpet-card-img-wrap" style="position:relative;">
                            @if (!string.IsNullOrEmpty(ad.ImageUrl))
                            {
                                <img src="@ad.ImageUrl" alt="@Localizer["PetImage"]" class="lostpet-card-img" />
                            }
                            else
                            {
                                <div class="lostpet-card-placeholder"><i class="fa-solid fa-image fa-2x"></i></div>
                            }
                            <span class="city-badge">@ad.LastSeenCity</span>
                        </div>
                        <div class="lostpet-card-body">
                            <h5 class="lostpet-card-title"><i class="fa-solid fa-paw"></i> @ad.PetName</h5>
                            <div class="lostpet-card-meta">
                                <span class="lostpet-card-location"><i class="fa-solid fa-location-dot"></i> @ad.LastSeenLocation</span>
                                <span class="lostpet-card-date"><i class="fa-solid fa-calendar-days"></i> @ad.LastSeenDate.ToString("dd/MM/yyyy")</span>
                            </div>
                            <div class="lostpet-card-desc">@((ad.Description?.Length > 80) ? ad.Description.Substring(0, 80) + "..." : ad.Description)</div>
                            <a href="@Url.Action("Details", "LostPetAd", new { id = ad.Id })" class="btn-lostpet-action btn-lostpet-details"><i class="fa-solid fa-eye"></i> @Localizer["ViewDetails"]</a>
                        </div>
                    </div>
                }
            </div>
            @if (!Model.Any())
            {
                <div class="no-pets-message">
                    <p>@Localizer["NoLostPetsAvailable"]</p>
                </div>
            }
        </div>
    </div>
</div>
